<html>
<head>
<title>snipezzzz</title>
<script type="text/javascript">
function ajax_json(url, handler)
{
  var req = new XMLHttpRequest();

  req.onreadystatechange = function()
  {
    if (req.readyState==4)
    {
      if (req.status==200)
      {
        handler(JSON.parse(req.responseText));
      }
    } else {
      alert("Download was not successful");
    }
  }
  req.open("POST", url, true);
  req.send(null);		
}

function render_screen(elements)
{
  var canvas = document.getElementById("can");
  var context = canvas.getContext("2d");

  // clear canvas
  context.fillStyle = "#000000";
  context.fillRect(0, 0, can.width, can.height);

  // render each element
  for (var i = 0; i < elements.length; i++)
  {
    var elt = elements[i];
    switch (elt.type)
    {
    case "rectangle":
      context.fillStyle = elt.color;
      context.fillRect(elt.x, elt.y, elt.width, elt.height);
      break;
    case "circle":
      context.fillStyle = elt.color;
      context.beginPath();
      context.arc(elt.x, elt.y, elt.radius, 0, Math.PI * 2, true);
      context.closePath();
      context.fill();
      break;
    case "hollow_box":
      ... USE:  elt.x elt.y elt.width elt.height elt.color
      context.strokeStyle = elt.color;
      context.strokeRect(elt.x, elt.y, elt.width, elt.height);
      break;
    }
  }
}


var in_game = false;
var game_name;
var user_name;

function update_handler()
{
  // compute update url
  var url = "/update?user=" . urlencode(user_name);
  ...

  // Make request, with a callback that will re-invoke this
  // function.  (The server blocks if we request twice in
  // one update cycle, so this is efficient, i.e. not just busy looping)
  ajax_json(url,
            function (j) {
	      render_screen(j);
	      update_handler();
	    }
	   );
}

// Code to allow the user the pick a running game,
// or start a new one.
function select_game()
{
  var container = document.getElementById("select_game");

  // delete the prior content 
  container.childNodes = [];

  // enable "Enter your user-id"
  document.getElementById("enter_user_id").style = "default"; ///XXX: what is the default style named?

  // enable "Start new game"
  ...

  // fetch the list of active games
  download("/games?user=" + urlencode(getElementById("userid_entry").text),
           function (j)
	   {
	     // handle the JSON response: create a list of active games,
	     // each of which will require an "onclick" handler.
	     ...

	     // make the selection menu visible
	     container.style = "visible";
           });
}

</script>
</head>
<body onload="select_game()" >

<h1>Snipez</h1>

<!-- will be filled up, occasionally, with a game-selection dialog -->
<p id="select_game" style="invisible">
</p>

<!-- dialog to enter the user-id, needed to join or create a game -->
<p id="enter_user_id" style="invisible">
Enter your user-id:
 <input type="text" id="user_id_input" />
</p>

<!-- space for rendering the world -->
<canvas id="can" width="700" height="400" style="invisible">
  
</canvas>

</body>
</html>
